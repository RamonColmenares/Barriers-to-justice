<!-- Research Page Content -->
<main class="page-content">
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-accent)] text-white py-20">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div>
          <p class="text-base font-semibold leading-7 text-white/90 mb-2">Our Research Focus</p>
          <h1 class="text-4xl font-bold tracking-tight sm:text-5xl lg:text-6xl">Understanding the Problem</h1>
          <p class="mt-6 text-xl leading-8 text-white/90">
            The 'Barriers to Justice' project investigates how immigration policies impact immigrant juveniles seeking protection. Our research focuses on the systemic challenges
            these young individuals face when navigating legal processes, aiming to identify key barriers and inform policy changes.
          </p>
        </div>
        <div class="relative">
          <div class="aspect-[4/3] w-full rounded-2xl bg-white/10 backdrop-blur-sm border border-white/20 flex items-center justify-center">
            <div class="text-center p-8">
              <svg class="w-24 h-24 mx-auto mb-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <h3 class="text-2xl font-bold mb-2">Research Excellence</h3>
              <p class="text-lg text-white/90">Evidence-based insights for policy change</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Research Methodology Section -->
  <section class="py-20 bg-white">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold tracking-tight text-[var(--color-primary)] sm:text-4xl">Research Methodology</h2>
        <p class="mt-4 text-lg leading-8 text-[var(--color-text-secondary)] max-w-3xl mx-auto">
          Our analysis is fully data-driven. We rely on public administrative datasets (EOIR case data, TRAC Immigration, and ORR) and quantitative methods to produce robust, actionable insights. No interviews or surveys were conducted.
        </p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <div class="bg-gradient-to-br from-[var(--color-background)] to-white rounded-2xl p-8 shadow-lg border border-gray-100">
          <div class="flex items-center mb-6">
            <div class="w-12 h-12 bg-[var(--color-accent)] rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold tracking-tight text-[var(--color-primary)]">Policy & Systems Analysis</h3>
          </div>
          <p class="text-lg leading-8 text-[var(--color-text-secondary)] mb-6">
            We examine how policy eras (2018–2025) shape representation and outcomes across the immigration system. By situating case-level results in their policy context, we identify where changes in enforcement and adjudication align with shifts in juvenile outcomes.
          </p>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-4 bg-white rounded-lg shadow-sm">
              <div class="text-2xl font-bold text-[var(--color-accent)]">2018–2025</div>
              <div class="text-sm text-[var(--color-text-secondary)]">Timeframe</div>
            </div>
            <div class="text-center p-4 bg-white rounded-lg shadow-sm">
              <div class="text-2xl font-bold text-[var(--color-accent)]">3</div>
              <div class="text-sm text-[var(--color-text-secondary)]">Policy Eras</div>
            </div>
          </div>
        </div>
        
        <div class="bg-gradient-to-br from-[var(--color-background)] to-white rounded-2xl p-8 shadow-lg border border-gray-100">
          <div class="flex items-center mb-6">
            <div class="w-12 h-12 bg-[var(--color-secondary)] rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold tracking-tight text-[var(--color-primary)]">Quantitative Methods</h3>
          </div>
          <p class="text-lg leading-8 text-[var(--color-text-secondary)] mb-6">
            We use time series analysis, chi-square tests, and logistic regression on EOIR case records to quantify relationships between legal representation, policy periods, and juvenile case outcomes. This yields a nuanced, evidence-based view without relying on interviews or surveys.
          </p>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-4 bg-white rounded-lg shadow-sm">
              <div class="text-2xl font-bold text-[var(--color-secondary)]">3</div>
              <div class="text-sm text-[var(--color-text-secondary)]">Core Methods</div>
            </div>
            <div class="text-center p-4 bg-white rounded-lg shadow-sm">
              <div class="text-2xl font-bold text-[var(--color-secondary)]">14,892</div>
              <div class="text-sm text-[var(--color-text-secondary)]">Cases Analyzed</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Dataset & Findings Section -->
  <section class="py-20 bg-gradient-to-br from-[var(--color-background)] to-gray-50">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold tracking-tight text-[var(--color-primary)] sm:text-4xl">Dataset Source & Key Findings</h2>
        <p class="mt-4 text-lg leading-8 text-[var(--color-text-secondary)] max-w-4xl mx-auto">
          The Executive Office for Immigration Review (EOIR) Case Data from Data.gov is the primary source of information for this project.
          Our analysis reveals critical insights about legal representation and case outcomes for juvenile immigrants.
        </p>
        <div class="mt-6 text-sm text-[var(--color-text-secondary)] max-w-4xl mx-auto">
          <p><strong>Data sources:</strong> EOIR Case Data (Data.gov), TRAC Immigration (Juvenile Tool), and ORR (UC Program Facts & Data). Analyses rely exclusively on these administrative datasets; no interviews or surveys were conducted.</p>
        </div>
      </div>
      
      <!-- Key Statistics -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
        <div class="bg-white rounded-2xl shadow-xl p-8 border-l-8 border-[var(--color-accent)] transform hover:scale-105 transition-transform duration-300">
          <div class="text-center">
            <div class="text-5xl font-bold text-[var(--color-accent)] mb-2" id="success-with-rep">—</div>
            <div class="text-lg font-semibold text-[var(--color-primary)] mb-2">Success Rate</div>
            <div class="text-sm text-[var(--color-text-secondary)]">With legal representation</div>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-xl p-8 border-l-8 border-[var(--color-secondary)] transform hover:scale-105 transition-transform duration-300">
          <div class="text-center">
            <div class="text-5xl font-bold text-[var(--color-secondary)] mb-2" id="success-without-rep">—</div>
            <div class="text-lg font-semibold text-[var(--color-primary)] mb-2">Success Rate</div>
            <div class="text-sm text-[var(--color-text-secondary)]">Without representation</div>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow-xl p-8 border-l-8 border-[var(--color-primary)] transform hover:scale-105 transition-transform duration-300">
          <div class="text-center">
            <div class="text-5xl font-bold text-[var(--color-primary)] mb-2" id="barriers-stat">—</div>
            <div class="text-lg font-semibold text-[var(--color-primary)] mb-2">Face Barriers</div>
            <div class="text-sm text-[var(--color-text-secondary)]">To accessing legal aid</div>
          </div>
        </div>
      </div>

      <!-- Key Insights -->
      <div class="bg-white rounded-2xl shadow-xl p-8 lg:p-12">
        <h3 class="text-2xl font-bold text-[var(--color-primary)] mb-8 text-center">Key Research Insights</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="space-y-6">
            <div class="flex items-start group">
              <div class="w-10 h-10 bg-[var(--color-accent)] rounded-full flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="font-semibold text-[var(--color-primary)] mb-2">Legal Representation Impact</h4>
                <p class="text-[var(--color-text-secondary)]">Juveniles with legal representation are significantly more likely to receive favorable decisions.</p>
              </div>
            </div>
            
            <div class="flex items-start group">
              <div class="w-10 h-10 bg-[var(--color-accent)] rounded-full flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="font-semibold text-[var(--color-primary)] mb-2">Policy Correlation</h4>
                <p class="text-[var(--color-text-secondary)]">Major policy changes align with changes in representation rates and case outcomes.</p>
              </div>
            </div>
          </div>
          
          <div class="space-y-6">
            <div class="flex items-start group">
              <div class="w-10 h-10 bg-[var(--color-accent)] rounded-full flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="font-semibold text-[var(--color-primary)] mb-2">Demographic Factors</h4>
                <p class="text-[var(--color-text-secondary)]">Demographic characteristics affect outcomes, but representation remains the most reliable predictor.</p>
              </div>
            </div>
            
            <div class="flex items-start group">
              <div class="w-10 h-10 bg-[var(--color-accent)] rounded-full flex items-center justify-center mr-4 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="flex-1">
                <h4 class="font-semibold text-[var(--color-primary)] mb-2">Systemic Barriers</h4>
                <p class="text-[var(--color-text-secondary)]">Multiple interconnected systems create compounding challenges for vulnerable youth.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Ethical Considerations Section -->
  <section class="py-20 bg-white">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold tracking-tight text-[var(--color-primary)] sm:text-4xl">Data Ethics and Limitations</h2>
        <p class="mt-4 text-lg leading-8 text-[var(--color-text-secondary)] max-w-4xl mx-auto">
          We focus on responsible use of public administrative data: avoiding personally identifiable information, documenting methods, assessing bias, and communicating uncertainty. Key limitations include missing values, court-by-court variation, and the short 2025 window.
        </p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <!-- Ethical Framework -->
        <div class="bg-gradient-to-br from-[var(--color-background)] to-white rounded-2xl p-8 shadow-lg border border-gray-100">
          <div class="flex items-center mb-6">
            <div class="w-12 h-12 bg-[var(--color-primary)] rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 1l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 1z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-[var(--color-primary)]">Our Ethical Framework</h3>
          </div>
          
          <div class="space-y-4">
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-accent)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">No PII — Public/Admin Data Only</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">We analyze only public administrative datasets and avoid direct identifiers; results are aggregated to reduce re-identification risk.</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-accent)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Transparent, Reproducible Methods</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">Methods, assumptions, and sources are documented; versioned code and pipelines enable others to reproduce the analysis.</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-accent)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Bias Checks & Validation</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">We examine selection and measurement bias, run sensitivity checks, and cross-validate key figures with external sources when possible.</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-accent)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Responsible Communication of Uncertainty</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">We report limitations, confidence bounds, and data gaps, and avoid causal claims where the evidence is correlational.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Research Limitations -->
        <div class="bg-gradient-to-br from-gray-50 to-white rounded-2xl p-8 shadow-lg border border-gray-100">
          <div class="flex items-center mb-6">
            <div class="w-12 h-12 bg-[var(--color-secondary)] rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-[var(--color-primary)]">Research Limitations</h3>
          </div>
          
          <div class="space-y-4">
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-secondary)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Missing & Incomplete Data</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">Some key fields have gaps, which can affect estimates and model stability</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-secondary)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Court-to-Court Variation</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">Practices and timelines differ by court, which may influence outcomes independently of policy era</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-2 h-2 bg-[var(--color-secondary)] rounded-full mt-2 mr-3 flex-shrink-0"></div>
              <div>
                <h4 class="font-semibold text-[var(--color-primary)] mb-1">Recency of 2025 Period</h4>
                <p class="text-sm text-[var(--color-text-secondary)]">Limited time for cases to complete in 2025 reduces certainty about Trump Era II effects</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  import { onMount } from 'svelte';
  import { apiService } from '$lib/services/apiService.js';

  // Data stores
  let caseSummary = null;
  let representationOutcomes = null;
  let isLoading = true;
  let error = null;

  onMount(() => {
    loadDataStatistics();
  });

  async function loadDataStatistics() {
    isLoading = true;
    error = null;
    
    try {
      // Load both overview data and basic statistics using the new API service
      await Promise.all([
        loadOverviewData(),
        loadBasicStats()
      ]);
      
      // Update the statistics display
      updateStatistics();
      
      isLoading = false;
    } catch (err) {
      console.error('Error loading data statistics:', err);
      error = err.message;
      isLoading = false;
      
      // Keep fallback values if API fails
      useFallbackValues();
    }
  }

  async function loadOverviewData() {
    try {
      caseSummary = await apiService.getOverview();
    } catch (err) {
      console.error('Overview data error:', err);
      throw err;
    }
  }

  async function loadBasicStats() {
    try {
      representationOutcomes = await apiService.getBasicStatistics();
    } catch (err) {
      console.error('Basic statistics error:', err);
      throw err;
    }
  }

  function updateStatistics() {
    if (representationOutcomes) {
      // Update success rates with real data
      if (representationOutcomes.success_with_representation !== undefined) {
        document.getElementById('success-with-rep').textContent = `${representationOutcomes.success_with_representation}%`;
      }
      
      if (representationOutcomes.success_without_representation !== undefined) {
        document.getElementById('success-without-rep').textContent = `${representationOutcomes.success_without_representation}%`;
      }
      
      if (representationOutcomes.barriers_percentage !== undefined) {
        document.getElementById('barriers-stat').textContent = `${representationOutcomes.barriers_percentage}%`;
      }
    }
  }

  function useFallbackValues() {
    // Show large hyphens as placeholders when API fails
    document.getElementById('success-with-rep').textContent = '—';
    document.getElementById('success-without-rep').textContent = '—';
    document.getElementById('barriers-stat').textContent = '—';
  }
</script>
